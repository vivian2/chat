var userController=angular.module("userController",["ui.router"]);userController.controller("userController",function(e,n,t,o,r,s,a){function u(n){e.username=n.username,e.individual=n.individuals,e.group=n.groups,e.signature=n.signature||"编辑个性签名",e.load=n.img}function c(e,n){for(i=0;l=e.length,i<l;i++)if(e[i]&&e[i].sendName===n)return console.log(e[i]+"&"+n),!0}r.get("http://localhost:3000/user/"+t.username).success(function(e){u(e),s.emit("login",e.username)});var m=function(n){this.userid=n.userid,this.username=n.username,s.on("chat msg",function(n){var t=localStorage.getItem(n.from),t=JSON.parse(t);if(n.from==e.chatname){var o=t?t.length:0,r="<li class='clearfix'><p class='reply'></p><span class='replayname'></span></li>";if(angular.element(".chatContent").append(r),angular.element(".chatContent").find("p").eq(o).html(n.content),angular.element(".replayname").html(n.from),t)t.push({content:n.content,username:n.from}),localStorage.setItem(n.from,JSON.stringify(t));else{var t=[];t.push({content:n.content,username:n.from}),localStorage.setItem(n.from,JSON.stringify(t))}}else if(t)t.push({content:n.content,username:n.from}),localStorage.setItem(n.from,JSON.stringify(t));else{var t=[];t.push({content:n.content,username:n.from}),localStorage.setItem(n.from,JSON.stringify(t))}})};s.on("login",function(e){var n=new m(e);r.post("http://localhost:3000/addId",n.username,null,null,null,null,null,n.userid).success(function(e){console.log(e)})}),e.change=function(){n.go("profile",{username:t.username,signature:e.signature})},e.search=function(){r.post("http://localhost:3000/searchUser",e.otherPerson).success(function(n){"not exits"===n?(e.exit=function(){return!1},e.tip="用户不存在"):(e.exit=function(){return!0},e.othersignature=n.signature||"编辑个性签名",e.tip="",e.otherImg=n.img)})},e.addIt=function(){r.post("http://localhost:3000/addIndividual",t.username,null,null,e.otherPerson,e.othersignature,null,null,e.otherImg).success(function(e){console.log(e)}),a(function(){r.get("http://localhost:3000/user/"+t.username).success(function(e){u(e)})},1e3),e.exit=function(){return!1}},e.del=function(e){r.post("http://localhost:3000/delIndividual",t.username,null,null,null,null,e).success(function(e){u(e)})},e.chatWith=function(n){r.get("http://localhost:3000/user/"+t.username).success(function(o){e.chatname=o.individuals[n].username,angular.element(".chatContent").find("li").remove(),chatStorage=JSON.parse(localStorage.getItem(e.chatname))?JSON.parse(localStorage.getItem(e.chatname)):[],c(chatStorage,t.username)&&(e.cons=chatStorage)})}});